<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego Ambiental - Campeonato Para Atletismo Ibagué</title>
<style>
:root{
  --bg:#0b2545; --card:#ffffff; --accent:#ffcc00; --text:#021024; --good:#1b8a2e; --bad:#c62828;
  --focus: 3px solid #ffcc00;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:linear-gradient(180deg,#07203a 0%, #0b2545 100%);color:var(--card);-webkit-font-smoothing:antialiased;}
.container{max-width:820px;margin:18px auto;padding:18px;}
.card{background:var(--card);color:var(--text);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.25);}
.header{display:flex;gap:12px;align-items:center;justify-content:space-between}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#ff8a00);display:flex;align-items:center;justify-content:center;font-weight:bold;color:#021024}
.title{font-size:20px;font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:var(--accent);color:#021024;padding:8px 12px;border-radius:8px;border:0;font-weight:700;cursor:pointer}
.btn:focus{outline:var(--focus)}
.toggle{background:transparent;border:2px solid #ddd;padding:6px;border-radius:8px;cursor:pointer}
.main{margin-top:14px;display:flex;gap:18px;flex-direction:column}
.question{display:flex;flex-direction:column;gap:8px}
.options label{display:block;padding:8px;border-radius:8px;border:1px solid #ddd;margin:6px 0;cursor:pointer;transition:transform .12s ease}
.options input{margin-right:8px}
.options label:hover{transform:translateX(4px)}
.progress-bar{height:12px;background:#e6e6e6;border-radius:999px;overflow:hidden}
.progress-bar > span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#ff8a00);transition:width .5s ease}
.scoreboard{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.scorebox{background:linear-gradient(180deg,#f7f7f7,#e9e9e9);padding:10px;border-radius:8px;color:var(--text);font-weight:700}
.animated-correct{animation:pop .6s ease;}
.animated-wrong{animation:shake .6s ease}
@keyframes pop{0%{transform:scale(.9);opacity:.6}50%{transform:scale(1.08)}100%{transform:scale(1)}}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}

/* Accessibility helpers */
.controls small{font-size:12px;color:#333}
.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
footer{margin-top:12px;font-size:13px;color:#f4f4f4}

/* Responsive */
@media (max-width:600px){
  .header{flex-direction:column;align-items:flex-start;gap:8px}
  .logo{width:48px;height:48px}
}
</style>
</head>
<body>
<a class="visually-hidden" href="#main">Saltar al contenido</a>
<div class="container" role="application" aria-labelledby="appTitle">
  <div class="card header" aria-hidden="false">
    <div class="brand">
      <div class="logo" aria-hidden="true">IA</div>
      <div>
        <div id="appTitle" class="title">Juego Ambiental - Campeonato Para Atletismo (Ibagué)</div>
        <div style="font-size:13px;color:#444">Juego rápido para personal de apoyo y atletas — accesible y guiado</div>
      </div>
    </div>
    <div class="controls" aria-hidden="false">
      <button id="increaseText" class="toggle" title="Aumentar tamaño de letra">A+ Texto</button>
      <button id="contrast" class="toggle" title="Alto contraste">Alto contraste</button>
      <button id="startBtn" class="btn" aria-controls="main">Iniciar Juego</button>
    </div>
  </div>

  <main id="main" class="card main" tabindex="0" aria-live="polite">
    <div class="scoreboard" aria-hidden="false">
      <div class="scorebox" id="qInfo">Preguntas: <span id="qNum">0</span>/10</div>
      <div class="scorebox">Puntaje: <span id="points">0</span></div>
      <div class="scorebox">Aciertos: <span id="correct">0</span></div>
      <div class="scorebox">Errores: <span id="wrong">0</span></div>
    </div>

    <div class="progress" style="margin-top:12px">
      <div class="progress-bar" aria-hidden="false" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <span id="progressSpan" style="width:0%"></span>
      </div>
    </div>

    <section id="questionArea" class="question" aria-live="polite" style="margin-top:12px;">
      <h2 id="qTitle">Bienvenido</h2>
      <p id="qText">Presiona "Iniciar Juego" para comenzar. Puedes aumentar la letra y activar alto contraste si lo necesitas.</p>
      <form id="options" class="options" role="radiogroup" aria-labelledby="qTitle"></form>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="submit" class="btn" disabled>Responder</button>
        <button id="next" class="toggle" disabled>Siguiente</button>
        <button id="finish" class="toggle" disabled>Terminar</button>
      </div>
      <div id="feedback" aria-live="assertive" style="margin-top:8px"></div>
    </section>

    <div aria-hidden="true" id="srStatus" class="visually-hidden" role="status"></div>

    <footer>
      <small>Desarrollado para el Campeonato de Para Atletismo — Ibagué. Código de colores: Blanco (Aprovechables), Verde (Orgánicos), Negro (No aprovechables).</small>
    </footer>
  </main>
</div>

<script>
// Questions bank (10 preguntas)
const QUESTIONS = [
  {q:"¿Qué bolsa se usa para residuos orgánicos?", a:"verde",
   opts:[{v:"blanco",t:"Blanco"},{v:"verde",t:"Verde (orgánicos)"},{v:"negro",t:"Negro"}], info:"Orgánicos: restos de comida y cáscaras."},
  {q:"¿Qué va en la bolsa blanca?", a:"aprovechables",
   opts:[{v:"aprovechables",t:"Aprovechables (papel, cartón, botellas)"},{v:"org",t:"Orgánicos"},{v:"no",t:"No aprovechables"}], info:"Blanco para materiales que se pueden reciclar."},
  {q:"¿Qué acción NO es buena práctica ambiental?", a:"dejar_basura",
   opts:[{v:"ahorrar_agua",t:"Ahorrar agua"},{v:"dejar_basura",t:"Dejar basura"},{v:"cuidar",t:"Cuidar zonas verdes"}], info:"Dejar basura contamina y afecta la experiencia del evento."},
  {q:"¿Cuál es una buena práctica durante el evento para ahorrar agua?", a:"grifo_cerrar",
   opts:[{v:"grifo_cerrar",t:"Cerrar grifos correctamente"},{v:"banos_llenar",t:"Llenar baños con agua extra"},{v:"regar",t:"Regar zonas no autorizadas"}], info:"Cerrar grifos evita desperdicio."},
  {q:"¿Qué significa el código de colores 'Negro' en residuos?", a:"no_aprovechable",
   opts:[{v:"no_aprovechable",t:"No aprovechables (residuos contaminados)"},{v:"aprovechable",t:"Aprovechable"},{v:"organico",t:"Orgánico"}], info:"Negro para residuos que no se pueden reciclar."},
  {q:"¿Dónde puedes colocar los residuos reciclables durante el campeonato?", a:"puntos_recoleccion",
   opts:[{v:"puntos_recoleccion",t:"En los puntos de recolección señalizados"},{v:"cerca_pista",t:"En la pista"},{v:"bolsas_personales",t:"En bolsas personales sin clasificar"}], info:"Usar puntos señalizados facilita reciclaje."},
  {q:"¿Qué debes hacer con los envases plásticos vacíos?", a:"reciclar",
   opts:[{v:"reciclar",t:"Reciclarlos en la bolsa blanca"},{v:"tirar",t:"Tirarlos en la cancha"},{v:"lavar_y_botar",t:"Lavarlos y botarlos en la zona verde"}], info:"Plásticos limpios van en aprovechables."},
  {q:"¿Por qué es importante proteger las zonas verdes cercanas al estadio?", a:"proteger",
   opts:[{v:"proteger",t:"Porque son hábitat y ayudan a la calidad del aire"},{v:"usar",t:"Para almacenar materiales"},{v:"pisotear",t:"No importa pisotearlas"}], info:"Zonas verdes ayudan al bienestar del evento."},
  {q:"¿Qué puedes hacer para reducir el consumo de energía?", a:"apagar_luces",
   opts:[{v:"apagar_luces",t:"Apagar luces y equipos cuando no se usan"},{v:"dejar_prendido",t:"Dejar equipos encendidos"},{v:"usar_generadores",t:"Usar generadores todo el tiempo"}], info:"Apagar reduce consumo y emisiones."},
  {q:"¿Cuál es una práctica para un manejo responsable de residuos orgánicos?", a:"compostar",
   opts:[{v:"compostar",t:"Compostar los residuos orgánicos"},{v:"incinerar",t:"Incinerarlos en el sitio"},{v:"enterrar",t:"Enterrarlos en zonas verdes"}], info:"Compostaje transforma residuos en abono."}
];

let idx=0, points=0, correct=0, wrong=0;
const total = QUESTIONS.length;

const qNumEl = document.getElementById('qNum');
const pointsEl = document.getElementById('points');
const correctEl = document.getElementById('correct');
const wrongEl = document.getElementById('wrong');
const qTitle = document.getElementById('qTitle');
const qText = document.getElementById('qText');
const optionsForm = document.getElementById('options');
const submitBtn = document.getElementById('submit');
const nextBtn = document.getElementById('next');
const startBtn = document.getElementById('startBtn');
const finishBtn = document.getElementById('finish');
const progressSpan = document.getElementById('progressSpan');
const feedback = document.getElementById('feedback');
const srStatus = document.getElementById('srStatus');

function playTone(freq, time=0.12){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine'; o.frequency.value = freq;
    g.gain.value = 0.05;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + time);
    setTimeout(()=>{o.stop(); ctx.close();}, Math.max(120, time*1000));
  }catch(e){}
}

function updateStatus(){
  qNumEl.textContent = idx+1 > total ? total : idx+1;
  pointsEl.textContent = points;
  correctEl.textContent = correct;
  wrongEl.textContent = wrong;
  const pct = Math.round(((idx)/total)*100);
  progressSpan.style.width = pct + "%";
  document.querySelector('.progress-bar').setAttribute('aria-valuenow', pct);
}

function renderQuestion(i){
  const Q = QUESTIONS[i];
  qTitle.textContent = "Pregunta " + (i+1);
  qText.textContent = Q.q;
  optionsForm.innerHTML = "";
  Q.opts.forEach((opt, oi)=>{
    const id = "opt_"+i+"_"+oi;
    const label = document.createElement('label');
    label.setAttribute('for', id);
    label.tabIndex = 0;
    label.id = id+"_label";
    label.innerHTML = `<input type="radio" name="answer" id="${id}" value="${opt.v}" aria-labelledby="${id}_label_text"><span id="${id}_label_text">${opt.t}</span>`;
    optionsForm.appendChild(label);
  });
  submitBtn.disabled = false;
  nextBtn.disabled = true;
  finishBtn.disabled = false;
  feedback.textContent = "";
  srStatus.textContent = "Pregunta " + (i+1) + " de " + total;
  updateStatus();
}

function evaluateAnswer(){
  const checked = document.querySelector('input[name="answer"]:checked');
  if(!checked){ feedback.textContent = "Selecciona una respuesta."; return false; }
  const val = checked.value;
  const correctVal = QUESTIONS[idx].a;
  // scoring: +10 correct, -2 wrong (min 0)
  if(val === correctVal){
    points += 10;
    correct++;
    playTone(900,0.12);
    feedback.textContent = "Correcto ✅ — " + QUESTIONS[idx].info;
    feedback.className = "animated-correct";
  } else {
    points = Math.max(0, points - 2);
    wrong++;
    playTone(240,0.18);
    feedback.textContent = "Incorrecto ❌ — " + QUESTIONS[idx].info;
    feedback.className = "animated-wrong";
  }
  submitBtn.disabled = true;
  nextBtn.disabled = false;
  // save to localStorage leaderboard
  saveProgress();
  updateStatus();
  return true;
}

function saveProgress(){
  // keep best score in localStorage
  try{
    const prev = parseInt(localStorage.getItem('best_score')||'0');
    if(points > prev) localStorage.setItem('best_score', points);
  }catch(e){}
}

function showFinal(){
  const best = localStorage.getItem('best_score') || 0;
  const msg = `Juego terminado — Puntaje: ${points} \nAciertos: ${correct} \nErrores: ${wrong} \nMejor puntaje local: ${best}`;
  feedback.textContent = msg;
  feedback.className = "";
  // announce for screen readers
  srStatus.textContent = msg;
  document.getElementById('progressSpan').style.width = "100%";
  submitBtn.disabled = true; nextBtn.disabled = true; finishBtn.disabled = true;
  // encourage sharing
  const shareText = encodeURIComponent("Acabo de jugar el Juego Ambiental en Ibagué y obtuve " + points + " puntos. ¡Cuida el ambiente!");
  const twitter = "https://twitter.com/intent/tweet?text=" + shareText;
  const shareBtn = document.createElement('a');
  shareBtn.href = twitter; shareBtn.target = "_blank"; shareBtn.className = "btn";
  shareBtn.textContent = "Compartir resultado";
  feedback.appendChild(document.createElement('div')).appendChild(shareBtn);
  // store last result
  try{ localStorage.setItem('last_result', JSON.stringify({points,correct,wrong,when:Date.now()})); }catch(e){}
}

startBtn.addEventListener('click', ()=>{
  idx = 0; points=0; correct=0; wrong=0;
  renderQuestion(idx);
  startBtn.disabled = true;
  startBtn.textContent = "En juego...";
  startBtn.classList.add('toggle');
  document.getElementById('submit').disabled = false;
});

submitBtn.addEventListener('click', (e)=>{
  e.preventDefault();
  if(evaluateAnswer()){
    // nothing
  }
});

nextBtn.addEventListener('click', ()=>{
  idx++;
  if(idx < total){
    renderQuestion(idx);
  } else {
    showFinal();
    startBtn.disabled = false;
    startBtn.textContent = "Reiniciar";
  }
});

finishBtn.addEventListener('click', ()=>{
  showFinal();
  startBtn.disabled = false;
  startBtn.textContent = "Reiniciar";
});

// accessibility toggles
document.getElementById('increaseText').addEventListener('click', ()=>{
  const el = document.querySelector('.card.main');
  const style = window.getComputedStyle(el).fontSize;
  const cur = parseFloat(style);
  el.style.fontSize = (cur + 2) + "px";
});
document.getElementById('contrast').addEventListener('click', ()=>{
  document.body.classList.toggle('highcontrast');
  if(document.body.classList.contains('highcontrast')){
    document.documentElement.style.setProperty('--bg','#000000');
    document.documentElement.style.setProperty('--card','#ffffff');
    document.documentElement.style.setProperty('--text','#000000');
  } else {
    document.documentElement.style.removeProperty('--bg');
    document.documentElement.style.removeProperty('--card');
    document.documentElement.style.removeProperty('--text');
  }
});

// keyboard support: pressing Enter on labels selects radio
options.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){ e.preventDefault(); const r = e.target.querySelector('input[type=radio]'); if(r) r.checked = true; }
});

// initial status
updateStatus();

</script>
</body>
</html>
